from labs.grading import Default as GuidedExercise
from labs.common.userinterface import Console
from ad482.common import prechecks, steps


class StreamsData(GuidedExercise):

    """
    GE: Using Basic Kafka Streams Objects
    """

    __LAB__ = "streams-data"

    topics = ["vehicle-positions", "vehicle-feet-elevations"]

    state_store_topics = ["vehicles"]

    def start(self):
        prechecks.verify_config()
        items = [
            steps.pull_apps_repo(),
            steps.copy_lab_app(self.__LAB__, "vehicles"),
            steps.copy_env_file(self.__LAB__),
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(),
            steps.check_kafka_connection(),
            steps.create_topics(self.topics)
        ]

        console = Console(items)
        console.run_items(action="Starting")

    def finish(self):
        items = [
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(False),
            steps.delete_topics(self.topics),
            steps.delete_state_store_topics(self.state_store_topics)
        ]
        Console(items).run_items(action="Finishing")
