from labs.common.userinterface import Console
from labs.grading import Default as GuidedExercise
from ad482.common import prechecks, steps


class KafkaConsumers(GuidedExercise):

    __LAB__ = "kafka-consumers"

    """
    Kafka consumers exercise
    """

    topic = "humidity-conditions"

    def start(self):
        prechecks.verify_config()
        items = [
            steps.pull_apps_repo(),
            steps.copy_lab_files(f"{self.__LAB__}/apps",
                                 self.__LAB__),
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(),
            steps.check_kafka_connection(),
            steps.create_topics([self.topic],
                                label=f"Create {self.topic} topic")
        ]

        Console(items).run_items(action="Starting")

    def finish(self):
        items = [
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(False),
            steps.delete_topics([self.topic])
        ]
        Console(items).run_items(action="Finishing")
