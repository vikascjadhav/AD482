from labs.grading import Default as GuidedExercise
from labs.common.userinterface import Console
from ad482.common import prechecks, steps


class ConnectCluster(GuidedExercise):
    __LAB__ = "connect-cluster"

    """
    Creating a Connect Cluster Guided Exercise
    """

    def start(self):
        prechecks.verify_config()
        items = [
            steps.pull_apps_repo(),
            steps.copy_lab_app(self.__LAB__, "resources"),
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(),
            steps.check_kafka_connection()
        ]
        Console(items).run_items(action="Starting")

    def finish(self):
        items = [
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(False),
            steps.delete_connect_connectors(
                ['filewatch-source-connector']
            ),
            steps.delete_connect_cluster('filewatch-connect-cluster'),
            steps.delete_topics(
                [
                    'test',
                    'filewatch-connect-cluster-configs',
                    'filewatch-connect-cluster-offsets',
                    'filewatch-connect-cluster-status'
                ]
            )
        ]
        Console(items).run_items(action="Finishing")
