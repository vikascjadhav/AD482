
from ad482.common import prechecks, steps
from labs.common.userinterface import Console
from labs.grading import Default as GuidedExercise


class CollaborationStateless(GuidedExercise):

    __LAB__ = "collaboration-stateless"

    """
    Stateless Collaboration Guided Exercise
    """

    topics = [
        'bank-account-creation',
        'bank-account-deposit',
        'bank-account-withdrawn',
        'high-value-deposit-alert',
        'low-risk-withdrawn-alert',
        'moderate-risk-withdrawn-alert',
        'high-risk-withdrawn-alert'
    ]

    def start(self):
        prechecks.verify_config()
        items = [
            steps.pull_apps_repo(),
            steps.copy_lab_files(
                f"{self.__LAB__}/apps/red-hat-bank",
                self.__LAB__
            ),
            steps.copy_env_file(
                f"{self.__LAB__}/.env",
                ".env-streams"
            ),
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(),
            steps.check_kafka_connection(),
            steps.create_topics(self.topics)
        ]
        Console(items).run_items(action="Starting")

    def finish(self):
        items = [
            steps.check_ocp_api(),
            steps.check_ocp_credentials(),
            steps.move_to_kafka_cluster_namespace(False),
            steps.delete_topics(self.topics),
        ]
        Console(items).run_items(action="Finishing")
